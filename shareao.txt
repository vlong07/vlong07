import aiohttp
import asyncio
import random
from colorama import Fore
import os
import json
import requests
import urllib3
urllib3.disable_warnings()
import sys
import time
from time import sleep
vLongzZ()
os.system("cls" if os.name == "nt" else "clear")

async def share_post(session, token, post_id, share_number):
    headers = {
        'accept': '*/*',
        'accept-encoding': 'gzip, deflate',
        'connection': 'keep-alive',
        'content-length': '0',
        'host': 'graph.facebook.com'
    }
    try:
        url = f'https://graph.facebook.com/me/feed'
        params = {
            'link': f'https://m.facebook.com/{post_id}',
            'published': '0',
            'access_token': token
        }
        async with session.post(url, headers=headers, params=params) as response:  
            res = await response.json()
            if response.status == 200:
                print(f"{time.strftime('%H:%M:%S')} : {share_number}: thành công: {res}")
            else:
                print(f"{time.strftime('%H:%M:%S')} : {share_number}: thất bại: {res}")
    except Exception as e:
        print(f"{time.strftime('%H:%M:%S')} : {share_number} thất bại: {e}")

def read_tokens(file_path):
    with open(file_path, 'r') as file:
        return [line.strip() for line in file if line.strip()]

async def main(post_id, tokens, total_shares, batch_size):
    async with aiohttp.ClientSession() as session:
        for start in range(0, total_shares, batch_size):
            end = min(start + batch_size, total_shares)
            tasks = []
            for share_number in range(start + 1, end + 1):
                token = random.choice(tokens)
                tasks.append(share_post(session, token, post_id, share_number))
            await asyncio.gather(*tasks)

if __name__ == "__main__":
    linkpost = input("\033[1;36mNhập Link Bài Viết: ")
    get_id_post = requests.get('https://scaninfo.vn/api/fb/getID.php?url=' + linkpost, verify=False)
    hihi = get_id_post.json().get('id')
    post_id = hihi
    token_file = input("\033[1;36mNhập File Chứa Token: ")
    total_shares = int(input("\033[1;36mNhập Số Lần Chia Sẻ: "))
    số_share_sẽ_dừng_sau = 1000

    tokens = read_tokens(token_file)
    asyncio.run(main(post_id, tokens, total_shares, số_share_sẽ_dừng_sau))